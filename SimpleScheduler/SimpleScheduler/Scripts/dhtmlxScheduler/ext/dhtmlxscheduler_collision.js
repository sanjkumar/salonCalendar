/*
Copyright Dinamenta, UAB. http://www.dhtmlx.com
To use this component please contact sales@dhtmlx.com to obtain license
*/
Scheduler.plugin(function(a){(function(){function i(c){var b=a._props?a._props[a._mode]:null,d=a.matrix?a.matrix[a._mode]:null,g=b||d;if(b)var h=g.map_to;if(d)h=g.y_property;g&&c&&(n=a.getEvent(c)[h])}var n,e;a.config.collision_limit=1;a.attachEvent("onBeforeDrag",function(a){i(a);return!0});a.attachEvent("onBeforeLightbox",function(c){var b=a.getEvent(c);e=[b.start_date,b.end_date];i(c);return!0});a.attachEvent("onEventChanged",function(c){if(!c)return!0;var b=a.getEvent(c);if(!a.checkCollision(b)){if(!e)return!1;
b.start_date=e[0];b.end_date=e[1];b._timed=this.isOneDayEvent(b)}return!0});a.attachEvent("onBeforeEventChanged",function(c){return a.checkCollision(c)});a.attachEvent("onEventAdded",function(c,b){var d=a.checkCollision(b);d||a.deleteEvent(c)});a.attachEvent("onEventSave",function(c,b){b=a._lame_clone(b);b.id=c;if(!b.start_date||!b.end_date){var d=a.getEvent(c);b.start_date=new Date(d.start_date);b.end_date=new Date(d.end_date)}b.rec_type&&a._roll_back_dates(b);return a.checkCollision(b)});a.checkCollision=
function(c){var b=[],d=a.config.collision_limit;if(c.rec_type)for(var g=a.getRecDates(c),h=0;h<g.length;h++)for(var e=a.getEvents(g[h].start_date,g[h].end_date),j=0;j<e.length;j++)(e[j].event_pid||e[j].id)!=c.id&&b.push(e[j]);else for(var b=a.getEvents(c.start_date,c.end_date),f=0;f<b.length;f++)if(b[f].id==c.id){b.splice(f,1);break}var i=a._props?a._props[a._mode]:null,o=a.matrix?a.matrix[a._mode]:null,m=i||o;if(i)var k=m.map_to;if(o)k=m.y_property;var l=!0;if(m){for(var p=0,f=0;f<b.length;f++)b[f][k]==
c[k]&&b[f].id!=c.id&&p++;p>=d&&(l=!1)}else b.length>=d&&(l=!1);if(!l){var q=!a.callEvent("onEventCollision",[c,b]);q||(c[k]=n||c[k]);return q}return l}})()});
